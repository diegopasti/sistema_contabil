{% extends 'base_page.html' %}

{% block Titulo %}
<meta charset="utf-8">
    <title>Digitar - Cadastro de Entidades</title>
{% endblock %}

{% block ArquivosEstaticos %}
{% load staticfiles %}

<!-- JQUERY -->
<script type="text/javascript" src="{% static 'jquery/jquery-2.2.0.min.js' %}"></script>
<script src="{% static 'jquery/jquery-ui-1.11.4/jquery-ui.js' %}"></script>

<!-- BOOTSTRAP -->
<link href="{% static 'bootstrap/css/bootstrap.min.css' %}" rel="stylesheet"/>
<script src="{% static 'bootstrap/js/bootstrap.min.js' %}"></script>

<!-- JQUERY UI DATAPICKER -->
<link rel="stylesheet" href="{% static 'jquery/jquery-ui-1.11.4/jquery-ui.css' %}">
<!-- <link rel="stylesheet" href="//code.jquery.com/ui/1.11.0/themes/smoothness/jquery-ui.css"> -->

<!-- JQUERY STEPS
<script src="{% static 'jquery/jquery-steps-1.1.0/jquery.steps.min.js' %}" />
<link rel="stylesheet" href="{% static 'jquery/jquery-steps-1.1.0/jquery.steps.css' %}"/>
    <link rel="stylesheet" href="{% static 'jquery/jquery-steps-1.1.0/content.css' %}"/>
 -->


<!-- DATATABLE -->
<link rel="stylesheet" type="text/css" href="{% static 'datatable/DataTables-1.10.11/css/dataTables.bootstrap.min.css' %}"/>
<link rel="stylesheet" type="text/css" href="{% static 'datatable/plugins/responsivo/Responsive-2.0.2/css/responsive.bootstrap.min.css' %}"/>
<link rel="stylesheet" type="text/css" href="{% static 'datatable/plugins/select/Select-1.1.2/css/select.bootstrap.min.css' %}"/>

<script src="{% static 'datatable/DataTables-1.10.11/js/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'datatable/DataTables-1.10.11/js/dataTables.bootstrap.min.js' %}"></script>
<script src="{% static 'datatable/plugins/select/Select-1.1.2/js/dataTables.select.min.js' %}"></script>

<style type="text/css">

.row.better_col_spacings_first_chield [class*='col-']:first-child {
	padding-right:5px;
	padding-bottom:15px;
}

.row.better_col_spacings_last_chield [class*='col-']:last-child {
	padding-left:5px;
	padding-bottom:15px;
}

.row.better_col_middle_spacings [class*='col-']:not(:first-child):not(:last-child) {
  padding-right:5px;
  padding-left:5px;
  padding-bottom:15px;
}

.uppercase{ 
    text-transform: uppercase;
}

.lowercase{ 
    text-transform: lowercase;
}

.center_align{
    text-align: center;
}

.left_align{
	padding-left: 8px;
    text-align: left;
}

.right_align{
    text-align: right;
}

.scrollable {
    height: 100px;
    overflow-y: scroll;
  }

.dataTables_paginate {
	position: relative;
    display: block;
    top: 30px;
}

label {
    font-weight: normal !important;
}
</style>


{% endblock %}

{% block Principal %}
<div class="row">
	<div class="col-lg-12">
		<div class="panel panel-default" style="margin-top: -15px; margin-left: 0px; margin-right: 0px; ">
			<div class="panel-heading">

				<div class="row" style="height:30px; line-height: 30px">
					<div class="col-lg-7" >
						<b>Entidades</b>
					</div>

					<div class="col-lg-5">
						<a href="#myModal" role="button" class="btn btn-primary pull-right" data-toggle="modal" style="position: relative; margin-top: -2px; margin-right: -6px;" ><i class="fa fa-plus fa-1x"></i> Adicionar</a>
					</div>

					<!-- /.col-lg-6 -->
				</div>

			</div>
			<!-- /.panel-heading -->

			<div class="panel-body" style="padding-bottom: -10px; margin-top: 0px;">
				<div class="dataTable_wrapper">
					<table class="table table-striped table-bordered table-hover" id="datatable">

						<thead>
							<tr class="linha_cabecalho">
								<th style="vertical-align: middle;"></th>
								<th style="vertical-align: middle;">CNPJ</th>
								<th style="vertical-align: middle;">Razão Social</th>
								<th style="vertical-align: middle;">Nome Fantasia</th>
							</tr>
						</thead>

						<tbody>
							{% for item in dados %}

							<tr class="alinhado_meio clickable-row " data-href='/consultar_entidade/{{ item.id }}'>
								<td style="cursor:pointer">{{ item.id }}</td>
								<td style="cursor:pointer">{{ item.cpf_cnpj }}</td>
								<td align="left" style="cursor:pointer">{{ item.nome_razao }}</td>
								<td align="left" style="cursor:pointer">{{ item.apelido_fantasia }}</td>
							</tr>

							{% empty %}
    							<tr><td colspan="4" style='text-align:center;'>Adicione uma nova Entidade.</td></tr>
							{% endfor %}
						</tbody>
					</table>

                    <script>
					$('#datatable').DataTable({
						"pagingType": "simple_numbers",
						"lengthMenu": [[10, 100, -1], [10, 100, "All"]],
						"dom": '<"top">rt"<"rightcolumn"><"clear">p',
						"bSort": true,
						"ordering": true,
						"bAutoWidth": false,
						"aoColumns": [
					                  { "sWidth": "20px" },
					                  { "sWidth": null },
                                      { "sWidth": null },
                                      { "sWidth": null }
					    		    ],

                        //"columnDefs": [ {
						      //"targets": 0,
						      ///"data": null,
						      //"orderable": false,
						      //"className": 'details-control',
						      //"defaultContent": '<button><i class="fa fa-plus" aria-hidden="true"></i> oi</button>'
						    //} ]


					});

					var table = $('#datatable').DataTable();
					$('#datatable'+' tbody').on('click', 'tr', function () {

					     if ($(this).hasClass('selected') ) {
					    	 $(this).removeClass('selected');
							 //alert("desmarquei");
					    	 desabilitar_botao('#bt_excluir');
							 desabilitar_botao('#bt_alterar');
					    	 $('#bt_excluir').addClass('link_desabilitado');
							 $('#bt_alterar').addClass('link_desabilitado');
					     }
					     else {
							 //alert("marquei");
					    	 table.$('tr.selected').removeClass('selected');
					    	 $(this).addClass('selected');
					    	 habilitar_botao('#bt_excluir');
							 habilitar_botao('#bt_alterar');
							 $('#bt_excluir').removeClass('link_desabilitado');
							 $('#bt_alterar').removeClass('link_desabilitado');

					    	//alert("Quero procurar os detalhes de: "+table.cell('.selected', 0).data());
					    	/*
					    	$.ajax({
								url: 'get_detalhes_protocolo/'+table.cell('.selected', 0).data(),
								type: 'get', //this is the default though, you don't actually need to always mention it
								success: function(data) {
									///alert(data['data']);

									$('#lb_emitido_por').text(data['emitido_por']);
									var table_detalhes = $('#datatable_detalhes').DataTable();
									table_detalhes.rows().remove();
									table_detalhes.rows.add(data['data']).draw();


									$("#datatable_detalhes tbody tr td").addClass("center_align");
									$("#datatable_detalhes tbody tr td:first-child").removeClass("centralizado").addClass("left_align");


									//alert("consegui?");

								},
								failure: function(data) {
									alert('Got an error dude');
								}
							});
							*/

					     }

					     $('#bt_excluir').click( function () {
							$.ajax({
								url: '/protocolo/documento/excluir/'+table.cell('.selected', 0).data(),
								type: 'get', //this is the default though, you don't actually need to always mention it
								success: function(data) {

									/*if (data=="SUCESS"){
										alert("Deu Certo Carai",data);
									}

									else{
										alert("Erro na exclusão! ",data);
									}
									*/
									table.row('.selected').remove().draw( false );
									$('#bt_excluir').addClass('link_desabilitado');
									$('#bt_alterar').addClass('link_desabilitado');
								},
								failure: function(data) {
									alert('Erro! Falha na exclusão do registro');
								}
							});


					        //alert("Vamos confirmar.. "+table.cell('.selected', 0).data());
					        //$("#protocolo_id").val(table.cell('.selected', 0).data());
					        //alert("Vamos confirmar.. "+table.cell('.selected', 0).data());
					     } );

					});

				</script>

				</div>

                <div class='row'>

                    {% if dados %}
					<div class="col-lg-2 col-md-2 col-sm-2 col-xs-6" style='margin-top:-36px;'>
                    {% else %}
                    <div class="col-lg-2 col-md-2 col-sm-2 col-xs-6" style='margin-top:6px;'>
                    {% endif %}

						<label id="label_buscar_por" class='left_align link_desabilitado'>
                            <sub>Buscar por:</sub>
                        </label>

                        <select id='buscar_por' class='form-control link_desabilitado '>
                             <option value="0">Código</option>
                             <option value="1" >Cpf ou Cnpj</option>
						 	 <option value="2" selected>Nome ou Razão Social</option>
                             <option value="3" >Apelido ou Nome Fantasia</option>
						</select>
					</div>

					{% if dados %}
					<div class="col-lg-4 col-md-4 col-sm-5 col-xs-6" style='margin-left:-20px;margin-top: -11px;'>
                    {% else %}
                    <div class="col-lg-4 col-md-4 col-sm-5 col-xs-6" style='margin-left:-20px;margin-top: 31px;'>
                    {% endif %}
						<input type="text" id="search" class="form-control link_desabilitado" placeholder="Consultar..">
					</div>

				</div>
                <!--
				<div class="col-lg-6">
					<input type="text" id="search" class="form-control" style="position: relative; margin-left: -15px; margin-top: -5px;" placeholder="Consultar..">
				</div>
				-->

			</div>
		</div>
	        </div>
        </div>
    </div>
</div>


<div id="myModal" class="modal fade"  tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="false">
  <div class="modal-dialog" style="width: 90%">
    <div class="modal-content">
      <div class="modal-header"><!-- style="height: 48px;"> -->
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h4 id="myModalLabel">Nova Entidade</h4>
      </div>

      <form action="" method="post">  <!-- <button type='submit' name='elevar_indice_categoria' value='{{ item.codigo }}  -->
	  	{% csrf_token %}
        <div class="modal-body">

            <div style="margin-top: 0px;">
                <ul class="nav nav-tabs">
                  <li class="active"><a data-toggle="tab" href="#informacoes_basicas">Informações Básicas</a></li>
                  <li><a data-toggle="tab" href="#menu1">Informações Complementares</a></li>
                  <li><a data-toggle="tab" href="#menu2">Informações Administrativas</a></li>
                </ul>


                <div class="tab-content" style="padding: 15px;padding-top:25px;">
                  <div id="informacoes_basicas" class="tab-pane fade in active">
                    <div>
                        <div class="row better_col_spacings_first_chield better_col_middle_spacings better_col_spacings_last_chield">

                        <div class="col-lg-2">
                            <div style='padding-left: 8px'>
                                <sub>
                                    <label id="lb_cpf_cnpj">{{ formulario.cpf_cnpj.label.upper }}</label>
                                </sub>
                            </div>
                            {{ formulario.cpf_cnpj }}
                        </div>

                        <div class="col-lg-5">
                            <div style='padding-left: 8px'>
                                <sub>
                                    <label id="lb_nome_razao">
                                        {{ formulario.nome_razao.label }}
                                    </label>
                                </sub>
                            </div>
                            {{ formulario.nome_razao }}
                        </div>

                        <div class="col-lg-3">
                            <div style='padding-left: 8px'>
                                <sub>
                                    <label id="lb_apelido_fantasia">{{ formulario.apelido_fantasia.label }}</label>
                                </sub>
                            </div>
                            {{ formulario.apelido_fantasia }}
                        </div>

                        <div class="col-lg-2">
                            <div style='padding-left: 8px'>
                                <sub> {{ formulario.tipo_registro.label }} </sub>
                            </div>
                            {{ formulario.tipo_registro }}
                        </div>

                    </div>

                        <div class="row better_col_spacings_first_chield better_col_middle_spacings better_col_spacings_last_chield">

                            <div class="col-lg-2">
                                <div style='padding-left: 8px'>
                                    <sub>
                                        <label id="lb_nascimento_fundacao">{{ formulario.nascimento_fundacao.label }}</label>
                                    </sub>
                                </div>
                                {{ formulario.nascimento_fundacao }}
                            </div>

                            <div class="col-lg-1">
                                <div style='padding-left: 8px'>
                                    <sub> {{ formulario.cep.label }} </sub>
                                </div>
                                {{ formulario.cep }}
                            </div>

                            <div class="col-lg-6">
                                <div style='padding-left: 8px'>
                                    <sub> {{ formulario.endereco.label }} </sub>
                                </div>
                                {{ formulario.endereco }}
                            </div>

                            <div class="col-lg-1">
                                <div style='padding-left: 8px'>
                                    <sub> {{ formulario.numero_endereco.label }} </sub>
                                </div>
                                {{ formulario.numero_endereco }}
                            </div>

                            <div class="col-lg-2">
                                <div style='padding-left: 8px'>
                                    <sub> {{ formulario.complemento.label }} </sub>
                                </div>
                                {{ formulario.complemento }}
                            </div>

                        </div>

                        <div class="row better_col_spacings_first_chield better_col_middle_spacings better_col_spacings_last_chield">

                            <div class="col-lg-3">
                                <div style='padding-left: 8px'>
                                    <sub> {{ formulario.bairro.label }} </sub>
                                </div>
                                {{ formulario.bairro }}
                            </div>

                            <div class="col-lg-4">
                                <div style='padding-left: 8px'>
                                    <sub> {{ formulario.municipio.label }} </sub>
                                </div>
                                {{ formulario.municipio }}
                            </div>

                            <div class="col-lg-2">
                                <div style='padding-left: 8px'>
                                    <sub> {{ formulario.codigo_municipio.label }} </sub>
                                </div>
                                {{ formulario.codigo_municipio }}
                            </div>

                            <div class="col-lg-2">
                                <div style='padding-left: 8px'>
                                    <sub> {{ formulario.estado.label }} </sub>
                                </div>
                                {{ formulario.estado }}
                            </div>

                            <div class="col-lg-1">
                                <div style='padding-left: 8px'>
                                    <sub> {{ formulario.pais.label }} </sub>
                                </div>
                                {{ formulario.pais }}
                            </div>

                        </div>

                        <div class="row better_col_spacings_first_chield better_col_middle_spacings better_col_spacings_last_chield">

                        </div>

                        <div class="row better_col_spacings_first_chield better_col_middle_spacings better_col_spacings_last_chield">
                            <div class="col-lg-2">
                                <div style='padding-left: 8px'>
                                    <sub> {{ formulario.tipo_contato.label }} </sub>
                                </div>
                                {{ formulario.tipo_contato }}
                            </div>

                            <div class="col-lg-2">
                                <div style='padding-left: 8px'>
                                    <sub> {{ formulario.numero_contato.label }} </sub>
                                </div>
                                {{ formulario.numero_contato }}
                            </div>

                            <div class="col-lg-3">
                                <div style='padding-left: 8px'>
                                    <sub> {{ formulario.cargo_setor.label }} </sub>
                                </div>
                                {{ formulario.cargo_setor }}
                            </div>

                            <div class="col-lg-5">
                                <div style='padding-left: 8px'>
                                    <sub> {{ formulario.email.label }} </sub>
                                </div>
                                {{ formulario.email }}
                            </div>
                        </div>
                    </div>
                  </div>

                  <div id="menu1" class="tab-pane fade">
                    <h3>Menu 1</h3>
                    <p>Some content in menu 1.</p>
                  </div>
                  <div id="menu2" class="tab-pane fade">
                    <h3>Menu 2</h3>
                    <p>Some content in menu 2.</p>
                  </div>
                </div>
            </div>





        </div>

        <div class="modal-footer">
            <div class="form-group">
                <button type="submit" id="bt_formulario" class="btn btn-success pull-right">Enviar</button>

                <!--  <p class="help-block pull-left text-danger hide" id="form-error">&nbsp;{{ message }}</p></div>  -->

            <!-- <button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button> -->
            </div>
          </div>
	  </form>
    </div>
  </div>
</div>

{% include "componentes/mensagem.html" with messages=messages %}
{% endblock %}

{% block ArquivosScripts %}
{% load staticfiles %}
<script type="text/javascript" src="{% static 'scripts/mask.js' %}"></script>

<script type="text/javascript">
$(".alert").fadeOut(6000);
</script>


<script type="text/javascript">
    $("#example-tabs").steps({
        headerTag: "h3",
        bodyTag: "section",
        transitionEffect: "slideLeft",
        enableFinishButton: false,
        enablePagination: false,
        enableAllSteps: true,
        titleTemplate: "#title#",
        cssClass: "tabcontrol"
    });
</script>


<script type="text/javascript">
$(function() {
	$("#nascimento_fundacao").datepicker({
		  dayNames: [ "Domingo", "Segunda", "Terça", "Quarta", "Quinta", "Sexta", "Sábado" ],
		  monthNames: [ "Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho", "Julho","Agosto","Setembro","Outubro","Novembro","Dezembro" ],
		  dayNamesMin: [ "D", "S", "T", "Q", "Q", "S", "S" ],
		  dateFormat: 'dd/mm/yy'
	});
});
</script>
<script type="text/javascript">
$('#codigo_postal').blur(function(){
	$.ajax({
		url: '/consultar_cep/'+$('#codigo_postal').val(),
	    type: 'get', //this is the default though, you don't actually need to always mention it
	    success: function(data) {
	    	$('#endereco').val(data[0]);
	    	$('#bairro').val(data[1]);
	    	$('#municipio').val(data[2]);
	    	$('#codigo_municipio').val(data[3]);
	    	$('#estado').val(data[4]);
	    	$('#pais').val(data[5]);
	        $('#numero_endereco').focus();
	      //alert(data);
	    },
	    failure: function(data) { 
	        alert('Got an error dude');
	    }
	}); 
}); 
</script>

<script>
$('.modal').on('hidden.bs.modal', function(){
	$(this).find('form')[0].reset();
});
</script>


<script>
     $('#search').on( 'keyup', function () {
        var table = $('#datatable').DataTable();
        var campo = $('#buscar_por').val();
        table.search('').columns().search( '' ).draw(); // reseta a pesquisa
        table.columns(campo).search($('#search').val()).draw();
        //table.search( this.value ).search(this.value).draw(); // Busca em todas as colunas
    });

    $('#buscar_por').change(function() {
            var table = $('#datatable').DataTable();
            var campo = $('#buscar_por').val();
            table.search('').columns().search( '' ).draw(); // reseta a pesquisa
            table.columns(campo).search($('#search').val()).draw();
    });

    {% if dados %}
        $('#buscar_por').removeClass('link_desabilitado');
        $('#search').removeClass('link_desabilitado');
        $('#label_buscar_por').removeClass('link_desabilitado');
        document.getElementById("search").focus();

    {% else  %}
        $('#buscar_por').addClass('link_desabilitado');
        $('#search').addClass('link_desabilitado');
    {% endif %}
</script>













<script type="text/javascript">
$('#tipo_contato').blur(function(){
	var campo_telefone = document.getElementById('tipo_contato');
	if (campo_telefone.value == 'C') {
		$("#numero_contato").mask("(99) 99999-9999");
	} else {		
		if (campo_telefone.value == 'F') {
			$("#numero_contato").mask("(99) 9999-9999");
		} else {
			$("#numero_contato").unmask();
		}
	} 
}); 
</script>

<script>
jQuery(document).ready(function(){
	//$("#cpf_cnpj").mask("99999999999999");
    $('#cpf_cnpj').tooltip({title: "Preencha somente os numeros!", animation: true, delay:{show: 200, hide: 200}, placement: "top"});
   	$("#nascimento_fundacao").mask("99/99/9999");
   	$("#numero_contato").mask("(99) 99999-9999");
   	$("#codigo_postal").mask("99999999");
});

$('#cpf_cnpj').blur(function(){
	var texto = $('#cpf_cnpj').val();
    if (texto.length == 11){
        $("#lb_cpf_cnpj").text("CPF:");
        $("#lb_nome_razao").text("Nome Completo:");
        $("#lb_apelido_fantasia").text("Apelido:");
        $("#lb_nascimento_fundacao").text("Nascimento:");
    }
    else{
        $("#lb_cpf_cnpj").text("CNPJ:");
        $("#lb_nome_razao").text("Razão Social:");
        $("#lb_apelido_fantasia").text("Nome Fantasia:");
        $("#lb_nascimento_fundacao").text("Fundação:");
    }
});

$('.numbersOnly').keyup(function () {
    if (this.value != this.value.replace(/[^0-9\.]/g, '')) {
       this.value = this.value.replace(/[^0-9\.]/g, '');

    }
});

</script>


<script>
$('.modal').on('hidden.bs.modal', function(){
    $(this).find('form')[0].reset();
});
</script>


<script>
$(document).ready(function() {
	
	{% if erro %}
    	$('#myModal').modal('show');
    	BootstrapDialog.show({
	        message: $("Tentando")
	    });
    
    {% else %}
		$('#myModal').modal('hide');
	{% endif %}
});

</script>

<meta charset="utf-8">
{% load staticfiles %}
<!-- DataTables JavaScript -->

<script	src="{% static 'datatable/datatables/media/js/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'datatable/datatables-plugins/integration/bootstrap/3/dataTables.bootstrap.min.js' %}"></script>
<!-- Page-Level Demo Scripts - Tables - Use for reference -->
 

<script>
jQuery(document).ready(function($) {
    $(".clickable-row").click(function() {
        window.document.location = $(this).data("href");
    });
});





$(".alert").fadeOut(4000 );

</script>

{% endblock %}